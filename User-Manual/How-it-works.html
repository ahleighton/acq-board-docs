

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How it works &#8212; Acquisition Board Docs 0.0.0 documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/_static/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Other equipment you will need" href="Acquisition-system-parts.html" />
    <link rel="prev" title="Quickstart guide" href="Quickstart-guide.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/oe_logo_name.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">User Manual</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../Build-Instructions/index.html">Build Instructions</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../Tutorials/index.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../FAQ/index.html">FAQs</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://open-ephys.org">Open Ephys<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/open-ephys" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/openephys" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
        
          
              <li class="">
                  <a href="Quickstart-guide.html">Quickstart guide</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">How it works</a>
              </li>
          
        
          
              <li class="">
                  <a href="Acquisition-system-parts.html">Other equipment you will need</a>
              </li>
          
        
          
              <li class="">
                  <a href="Electrodes.html">Compatible electrodes</a>
              </li>
          
        
          
              <li class="">
                  <a href="Headstages.html">Headstages</a>
              </li>
          
        
          
              <li class="">
                  <a href="Cables.html">Cables</a>
              </li>
          
        
          
              <li class="">
                  <a href="Peripheral-devices.html">Peripheral devices</a>
              </li>
          
        
          
              <li class="">
                  <a href="Computer-hardware.html">Computer hardware</a>
              </li>
          
        
          
              <li class="">
                  <a href="Acquisition-software.html">Acquisition software</a>
              </li>
          
        
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#neural-data-acquisition" class="nav-link">Neural data acquisition</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#opal-kelly-fpga" class="nav-link">Opal Kelly FPGA</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#analog-and-digital-i-o" class="nav-link">Analog and Digital I/O</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#power-supply" class="nav-link">Power Supply</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#other-features" class="nav-link">Other Features</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="how-it-works">
<span id="howitworks"></span><h1>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<p>This page provides some additional details about how the Acquisition Board works “under the hood”, rather than how the end user should interact with it. We recommend reading this page carefully before using the Acquisition Board, and especially if you’re going to build it. When something goes wrong, or if your data look suspicious, knowing the basics of how the hardware works will make it easier to troubleshoot. And the more people who have a thorough understanding of the Open Ephys ecosystem, the easier it will be to support new users.</p>
<p>The following material assumes a basic understanding of electronic circuits. If you don’t have any hands-on experience working with electronics, you can follow the Open Ephys course on extracellular electrophysiology <a class="reference external" href="https://ahleighton.github.io/OE-ephys-course/">here</a>. It would also be helpful to read through the documentation available on the Intan website, as almost everything related to the RHD2000 chips is relevant to the data you will collect with the Acquisition Board.</p>
<img alt="../_images/ac_board_pcb.png" src="../_images/ac_board_pcb.png" />
<div class="section" id="neural-data-acquisition">
<h2>Neural data acquisition<a class="headerlink" href="#neural-data-acquisition" title="Permalink to this headline">¶</a></h2>
<p>The filtering, amplification, and digitization of neural data is handled by Intan’s RHD chips. Each chip contains 32 or 64 20x gain amplifiers, as well as configurable bandpass filters. During the amplification step, the voltage from each electrode is referenced to either a common REF input (RHD2132 and RHD2164 chips), or to a separate reference/negative input for each channel (RHD2216 chips). The voltage is the multiplexed in time at a speed of up to 30 kHz per channel, and digitized by an on-chip 16-bit analog-to-digital converter (ADC). From this point on, electrical noise will not degrade the signal, as long as the integrity of the digital signals is maintained.</p>
<p>The data is transmitted from each Intan chip to the FPGA on the Acquisition Board via a serial protocol that also handles configuration of the chip (mainly setting of the bandpass filters) and transmits some extra data such as temperature, supply voltage at the headstage, and in the case of many headstages, accelerometer data. The headstages are connected using standardized SPI cables using 12-pin Omnetics connectors (part #PZN-12).</p>
</div>
<div class="section" id="opal-kelly-fpga">
<h2>Opal Kelly FPGA<a class="headerlink" href="#opal-kelly-fpga" title="Permalink to this headline">¶</a></h2>
<p>The heart of the acquisition board is the FPGA, or “Field-Programmable Gate Array.” This part makes up about half the cost of an acquisition board, so it better do something crucial. From a high-level perspective, the FPGA combines data from everything that’s connected to the acquisition board, attaches a common timestamp, and sends it to the computer via USB. It effectively acts as a “dumb pipe,” shuttling data between peripheral devices (such as headstages and I/O boards) and the computer, where more sophisticated processing can take place. However, this doesn’t even come close to taking advantage of all of the FPGA’s capabilities. An FPGA is sort of a cross between a microcontroller (like an Arduino) and a circuit composed of interconnected transistors. It can be reconfigured on the fly, but the modules that are uploaded all run in parallel, rather than being called consecutively inside a loop. That means the FPGA can be really fast and its timing can be very precise. This is essential for collecting data at 30 kHz per channel across each of an Intan chip’s 32 or 64 channels.</p>
<img alt="../_images/xem6310.jpg" src="../_images/xem6310.jpg" />
<p>We chose to use the Opal Kelly XEM6310 USB 3.0 board because of the terrific programming interface provided by Opal Kelly. If we just soldered the bare FPGA (Xilinx Spartan-6) to the acquisition board, it would have driven down costs significantly, but would have required some serious programming chops to get it to play nicely with the computer. Since we’re already at such a low price point, our most precious resource is time, rather than money.</p>
<p>The FPGA itself is programmed in a language called Verilog. Verilog is a type of “hardware description language,” because it specifies the actions of registers and logic gates, rather than functions and variables. Verilog is compiled to a “bitfile,” which must be uploaded to the FPGA each time it’s used. Compiling the bitfile can take several minutes, but uploading it occurs almost instantaneously. The Verilog code that runs on the acquisition board FPGA is our custom version of the “Rhythm” interface developed by Intan. We had to change a few things in order to communicate with our analog-to-digital converters (we’re using Texas Instruments ADCs, rather than Analog Devices) and control the 8 LEDs on the board. If you’re interested, you can take a look at the <a class="reference external" href="https://github.com/open-ephys/rhythm">source code</a> (but this is not recommended unless you have some prior Verilog experience).</p>
</div>
<div class="section" id="analog-and-digital-i-o">
<h2>Analog and Digital I/O<a class="headerlink" href="#analog-and-digital-i-o" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="Peripheral-devices.html#peripheraldevices"><span class="std std-ref">Peripheral devices</span></a>.</p>
</div>
<div class="section" id="power-supply">
<h2>Power Supply<a class="headerlink" href="#power-supply" title="Permalink to this headline">¶</a></h2>
<p>The acquisition board runs on a 5V DC power supply. DO NOT use any other type of power supply, as it could permanently damage the board.</p>
<p>Since consumer-grade wall socket power supplies tend to be rather noisy, we have added our own 5V regulators on the board. There are a few other regulators for different functions, such as powering the headstages and creating a –5V rail for the op amps.</p>
<p>Below is a schematic of all the voltage levels on the board. The main ones have test holes labeled on the bottom of the board, so you can check the voltage without opening up the case.</p>
<img alt="Details of the internal voltages" src="../_images/powersupply.png" />
</div>
<div class="section" id="other-features">
<h2>Other Features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<p><em>LEDs:</em> The eight WS2812B LEDs can be controlled via a single digital line, and don’t require any external parts except for a 0.1 µF bypass capacitor.</p>
<p><em>BNC clock output:</em> The connector is a great way to ground your board if you’re running it off battery power! You would do this by connecting the outer shield of this connector (NOT the center pin) to an appropriate ground – a large metal rack, a piece of copper sunk deep into the wall, or even the ground plug of a 3-prong outlet.</p>
<p><em>I2C bus:</em> Each of the four HDMI ports includes 2 channels that are connected to an I2C bus. This will provide a convenient way to expand the functionality of the acquisition board through custom I/O boards. However, the I2C functionality hasn’t yet been added to the FPGA firmware.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="Quickstart-guide.html" title="previous page">Quickstart guide</a>
    <a class='right-next' id="next-link" href="Acquisition-system-parts.html" title="next page">Other equipment you will need</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2010-2021, Open Ephys &amp; Contributors.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>